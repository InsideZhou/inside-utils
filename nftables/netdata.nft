#!/usr/sbin/nft -f


table ip netdata {
    define safehosts = {
        192.168.0.0/16,
        10.0.4.16/22,
        127.0.0.1
    }

    set connlimit {
        typeof ip saddr
        size 4294967296
    }

    chain netdata {
        type filter hook input priority filter

        ip saddr != $safehosts tcp dport 19999 ct state new add @connlimit { ip saddr ct count over 4 } reject with tcp reset
    }
}
